!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.UniversalSocialauth=e():t.UniversalSocialauth=e()}(self,(function(){return(()=>{"use strict";var t={d:(e,o)=>{for(var n in o)t.o(o,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:o[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},e={};t.d(e,{default:()=>U});const o={baseUrl:null,tokenName:"token",tokenPrefix:"vueauth",tokenHeader:"Authorization",tokenType:"Bearer",loginUrl:"/auth/login",registerUrl:"/auth/register",logoutUrl:null,storageType:"localStorage",storageNamespace:"vue3-social-auth",cookieStorage:{domain:window.location.hostname,path:"/",secure:!1},requestDataKey:"data",responseDataKey:"data",bindRequestInterceptor:function(t){console.log("$auth",t);var e=t.options.tokenHeader;t.$http.interceptors.request.use((function(t){return console.log("bindRequestInterceptor",t),delete t.headers[e],t}))},bindResponseInterceptor:function(t){t.$http.interceptors.response.use((function(t){return console.log("bindResponseInterceptor",t),t}))},provider:{}};function n(t,e){return/^(?:[a-z]+:)?\/\//i.test(e)?e:[t,e].join("/").replace(/[/]+/g,"/").replace(/\/\?/g,"?").replace(/\/#/g,"#").replace(/:\//g,"://")}function r(t){var e="https:"===t.protocol;return t.protocol+"//"+t.hostname+":"+(t.port||(e?"443":"80"))+(/^\//.test(t.pathname)?t.pathname:"/"+t.pathname)}function i(t){var e,o,n={};return(t||"").split("&").forEach((function(t){t&&(o=t.split("="),e=decodeURIComponent(o[0]),n[e]=!o[1]||decodeURIComponent(o[1]))})),n}function s(t){var e=t.path,o=t.domain,n=t.expires,r=t.secure;return[null==e?"":";path="+e,null==o?"":";domain="+o,null==n?"":";expires="+n.toUTCString(),null==r||!1===r?"":";secure"].join("")}function a(t,e,o){return[encodeURIComponent(t),"=",encodeURIComponent(e),s(o)].join("")}"function"!=typeof Object.assign&&(Object.assign=function(t){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),o=1;o<arguments.length;o++){var n=arguments[o];if(null!=n)for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e});var u=function(){return(u=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};const p=function(){function t(t){var e={domain:window.location.hostname,expires:null,path:"/",secure:!1};this._defaultOptions=u(u({},e),t)}return t.prototype.setItem=function(t,e){var o=a(t,e,u({},this._defaultOptions));this._setCookie(o)},t.prototype.getItem=function(t){var e=function(t){if(0===t.length)return{};var e={},o=new RegExp("\\s*;\\s*");return t.split(o).forEach((function(t){var o=t.split("="),n=o[0],r=o[1],i=decodeURIComponent(n),s=decodeURIComponent(r);e[i]=s})),e}(this._getCookie());return void 0!==e[t]?e[t]:null},t.prototype.removeItem=function(t){var e=u({},this._defaultOptions),o=a(t,"",u(u({},e),{expires:new Date(0)}));this._setCookie(o)},t.prototype._getCookie=function(){return"undefined"==typeof document||void 0===document.cookie?"":document.cookie},t.prototype._setCookie=function(t){document.cookie=t},t}(),c=function(){function t(t){this.namespace=t||null}return t.prototype.setItem=function(t,e){window.localStorage.setItem(this._getStorageKey(t),e)},t.prototype.getItem=function(t){return window.localStorage.getItem(this._getStorageKey(t))},t.prototype.removeItem=function(t){window.localStorage.removeItem(this._getStorageKey(t))},t.prototype._getStorageKey=function(t){return this.namespace?[this.namespace,t].join("."):t},t}(),l=function(){function t(t){this.namespace=t||null,this._storage={}}return t.prototype.setItem=function(t,e){this._storage[this._getStorageKey(t)]=e},t.prototype.getItem=function(t){return this._storage[this._getStorageKey(t)]},t.prototype.removeItem=function(t){delete this._storage[this._getStorageKey(t)]},t.prototype._getStorageKey=function(t){return this.namespace?[this.namespace,t].join("."):t},t}(),h=function(){function t(t){this.namespace=t||null}return t.prototype.setItem=function(t,e){window.sessionStorage.setItem(this._getStorageKey(t),e)},t.prototype.getItem=function(t){return window.sessionStorage.getItem(this._getStorageKey(t))},t.prototype.removeItem=function(t){window.sessionStorage.removeItem(this._getStorageKey(t))},t.prototype._getStorageKey=function(t){return this.namespace?[this.namespace,t].join("."):t},t}();var f=function(){return(f=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};const d=function(){function t(t,e,o){this.popup=null,this.url=t,this.name=e,this.popupOptions=o}return t.prototype.open=function(t,e){try{if(this.popup=window.open(this.url,this.name,this._stringifyOptions()),this.popup&&this.popup.focus&&this.popup.focus(),e)return Promise.resolve();var o=this.pooling(t);return console.log("pool",o),o}catch(t){return Promise.reject(new Error("OAuth popup error occurred"))}},t.prototype.pooling=function(t){var e=this;return new Promise((function(o){var n=document.createElement("a");n.href=t;var s=r(n),a=window.setInterval((function(){e.popup&&!e.popup.closed&&void 0!==e.popup.closed||(clearInterval(a),a=0,g(new Error("Auth popup window closed")));try{var t=e.popup,n=r(t.location);if(console.log("location.location",t.location),console.log("redirectUriPath",s),n===s){if(t.location.search||t.location.hash){var u=i(t.location.search.substring(1).replace(/\/$/,"")),p=i(t.location.hash.substring(1).replace(/[/$]/,"")),c=f(f({},u),p);c.error?g(new Error(c.error)):o(c)}else g(new Error("OAuth redirect has occurred but no query or hash parameters were found."));clearInterval(a),a=0,t.close()}}catch(t){}}),250)}))},t.prototype._stringifyOptions=function(){var t=[],e=this.popupOptions;for(var o in console.log("Popup",e),e)void 0!==e[o]&&t.push(o+"="+e[o]);return t.join(",")},t}();function g(t){throw new Error("Function not implemented.")}var v=function(){return(v=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},y=function(t,e,o,n){return new(o||(o=Promise))((function(r,i){function s(t){try{u(n.next(t))}catch(t){i(t)}}function a(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?r(t.value):(e=t.value,e instanceof o?e:new o((function(t){t(e)}))).then(s,a)}u((n=n.apply(t,e||[])).next())}))},m=function(t,e){var o,n,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((r=(r=s.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],n=0}finally{o=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},w={name:null,url:null,authorizationEndpoint:null,scope:null,scopePrefix:null,scopeDelimiter:null,redirectUri:null,requiredUrlParams:null,defaultUrlParams:null,oauthType:"1.0",popupOptions:void 0};const b=function(){function t(t,e,o,n){this.$http=t,this.storage=e,this.providerConfig=v(v({},w),o),this.options=n}return t.prototype.init=function(t){return y(this,void 0,void 0,(function(){var e=this;return m(this,(function(o){return this.oauthPopup=new d("about:blank",this.providerConfig.name,this.providerConfig.popupOptions),window&&this.oauthPopup.open(this.providerConfig.redirectUri,!0),[2,this.getRequestToken().then((function(o){return y(e,void 0,void 0,(function(){var e,n;return m(this,(function(r){return e=this.openPopup(o),n=this.exchangeForToken(e,t),console.log("token",n),[2,n]}))}))}))]}))}))},t.prototype.getRequestToken=function(){return y(this,void 0,void 0,(function(){var t,e;return m(this,(function(o){return(t={}).method="POST",e=this.options.requestDataKey,t[e]=v({},this.providerConfig),t.withCredentials=this.options.withCredentials,this.options.baseUrl?t.url=n(this.options.baseUrl,this.providerConfig.url):t.url=this.providerConfig.url,console.log("requestOptions",t),[2,this.$http(t)]}))}))},t.prototype.openPopup=function(t){var e=t;console.log("openPopup",e);var o=e[this.options.responseDataKey],n=[this.providerConfig.authorizationEndpoint,this.buildQueryString(o)].join("?"),r=this.oauthPopup;return r.popup.location=n,window?r.open(this.providerConfig.redirectUri,this.providerConfig.skipPooling):r.pooling(this.providerConfig.redirectUri)},t.prototype.exchangeForToken=function(t,e){var o=v(v({},e),t),r={method:"POST"};return r[this.options.requestDataKey]=o,r.withCredentials=this.options.withCredentials,this.options.baseUrl?r.url=n(this.options.baseUrl,this.providerConfig.url):r.url=this.providerConfig.url,this.$http(r)},t.prototype.buildQueryString=function(t){console.log("oauth1 params",t);var e=[];for(var o in t){var n=t[o];e.push(encodeURIComponent(o)+"="+encodeURIComponent(n))}return e.join("&")},t}();var C=function(){return(C=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},I=function(t,e,o,n){return new(o||(o=Promise))((function(r,i){function s(t){try{u(n.next(t))}catch(t){i(t)}}function a(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?r(t.value):(e=t.value,e instanceof o?e:new o((function(t){t(e)}))).then(s,a)}u((n=n.apply(t,e||[])).next())}))},O=function(t,e){var o,n,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((r=(r=s.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],n=0}finally{o=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},k={name:null,url:null,clientId:null,authorizationEndpoint:null,redirectUri:null,scope:null,scopePrefix:null,scopeDelimiter:null,state:null,requiredUrlParams:null,defaultUrlParams:["response_type","client_id","redirect_uri"],responseType:"code",responseParams:{code:"code",clientId:"clientId",redirectUri:"redirectUri"},oauthType:"2.0",popupOptions:{}};const P=function(){function t(t,e,o,n){this.$http=t,this.storage=e,this.providerConfig=C(C({},k),o),this.options=n}return t.prototype.init=function(t){return I(this,void 0,void 0,(function(){var e,o,n,r,i,s,a,u,p;return O(this,(function(c){switch(c.label){case 0:e=this.providerConfig.name+"_state",o=this.providerConfig.state,n=this.providerConfig.state,"function"==typeof o?this.storage.setItem(e,o()):"string"==typeof n&&this.storage.setItem(e,n),r=[this.providerConfig.authorizationEndpoint,this._stringifyRequestParams()].join("?"),this.oauthPopup=new d(r,this.providerConfig.name,this.providerConfig.popupOptions),i=this.oauthPopup,c.label=1;case 1:return c.trys.push([1,4,,5]),(s=i.open(this.providerConfig.redirectUri,this.providerConfig.skipPooling))?(a=s,"code"!==this.providerConfig.responseType&&this.providerConfig.url?a.state&&a.state!==this.storage.getItem(e)?[2,new Error("State parameter value does not match original OAuth request state value")]:[4,this.exchangeForToken(a,t)]:[2,s]):[3,3];case 2:return u=c.sent(),console.log("token2",u),[2,u];case 3:return console.log("Oauth",s),[3,5];case 4:return p=c.sent(),[2,new Error(p)];case 5:return[2]}}))}))},t.prototype.exchangeForToken=function(t,e){return I(this,void 0,void 0,(function(){var o,r,i,s;return O(this,(function(a){switch(a.label){case 0:for(r in o=C({},e),k.responseParams)switch(r){case"code":o[r]=t.code;break;case"clientId":o[r]=this.providerConfig.clientId;break;case"redirectUri":o[r]=this.providerConfig.redirectUri;break;default:o[r]=t[r]}return t.state&&(o.state=t.state),i=this.options.baseUrl?n(this.options.baseUrl,this.providerConfig.url):this.providerConfig.url,[4,this.$http.post(i,o,{withCredentials:this.options.withCredentials})];case 1:return s=a.sent(),console.log("post",s),[2,s]}}))}))},t.prototype._stringifyRequestParams=function(){var t=this,e=[];return["defaultUrlParams","requiredUrlParams","optionalUrlParams"].forEach((function(o){t.providerConfig[o]&&Array.isArray(t.providerConfig[o])&&t.providerConfig[o].forEach((function(o){var n=o.replace(/([:\-_]+(.))/g,(function(t,e,o,n){return n?o.toUpperCase():o})),r=t.providerConfig[o],i="function"==typeof r?r():t.providerConfig[n];if("redirect_uri"!==o||i){if("state"===o){var s=t.providerConfig.name+"_state";i=encodeURIComponent(t.storage.getItem(s))}"scope"===o&&Array.isArray(i)&&(i=i.join(t.providerConfig.scopeDelimiter),t.providerConfig.scopePrefix&&(i=[t.providerConfig.scopePrefix,i].join(t.providerConfig.scopeDelimiter))),e.push([o,i])}}))})),e.map((function(t){return t.join("=")})).join("&")},t}();var S=function(){return(S=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};const U=function(){function t(t,e){t.interceptors.response.use((function(t){var e=t.data;return console.log("datadata",e),t})),Object.defineProperties(this,{$http:{get:function(){return t}},OverrideOptions:{get:function(){return e}},defaultOptions:{get:function(){return o}}})}return t.prototype.authenticate=function(t,e,o){return void 0===o&&(o={}),n=this,r=void 0,s=function(){var n,r,i,s,a,u,f,d,g,v;return function(t,e){var o,n,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((r=(r=s.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],n=0}finally{o=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}(this,(function(y){if(n=this.OverrideOptions,r=n.providers,i=r[t],s={provider:S(S({},e),i)},a=S(S({},this.defaultOptions),s),this.options=a,this.storage=function(t){switch(t.storageType){case"localStorage":try{return window.localStorage.setItem("testKey","test"),window.localStorage.removeItem("testKey"),new c(t.storageNamespace)}catch(t){}case"sessionStorage":try{return window.sessionStorage.setItem("testKey","test"),window.sessionStorage.removeItem("testKey"),new h(t.storageNamespace)}catch(t){}case"cookieStorage":return new p(t.cookieStorage);case"memoryStorage":default:return new l(t.storageNamespace)}}(a),f=(u=a).provider,d=f,!u.bindRequestInterceptor||"function"!=typeof u.bindRequestInterceptor||!u.bindResponseInterceptor||"function"!=typeof u.bindResponseInterceptor)throw new Error("Both request and response interceptors must be functions");if(g={options:this.options,storage:this.storage,$http:this.$http,providerConfig:f},u.bindRequestInterceptor.call(this,g),u.bindResponseInterceptor.call(this,g),!f)return[2,new Error("Unknown provider")];try{switch(v=void 0,d.oauthType){case"1.0":console.log("providerConfig",f),v=new b(this.$http,this.storage,f,a);break;case"2.0":v=new P(this.$http,this.storage,f,a);break;default:return[2,new Error("Invalid OAuth type")]}return[2,v.init(o).then((function(t){return t})).catch((function(t){return new Error(t)}))]}catch(t){return[2,t]}return[2]}))},new((i=void 0)||(i=Promise))((function(t,e){function o(t){try{u(s.next(t))}catch(t){e(t)}}function a(t){try{u(s.throw(t))}catch(t){e(t)}}function u(e){var n;e.done?t(e.value):(n=e.value,n instanceof i?n:new i((function(t){t(n)}))).then(o,a)}u((s=s.apply(n,r||[])).next())}));var n,r,i,s},t}();return e.default})()}));